<Window
    x:Class="Tetris.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:Tetris"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:Tetris.ViewModels" Title="Tetris" Width="800"
    Height="600" MinWidth="600" MinHeight="600"
    d:DataContext="{d:DesignInstance vm:MainViewModel,
                                     IsDesignTimeCreatable=True}"
    FontFamily="Segoe UI Light" FontSize="28" Foreground="White" mc:Ignorable="d">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="KeyDown">
            <i:InvokeCommandAction
                Command="{Binding KeyDownCommand}"
                PassEventArgsToCommand="True" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <!--  CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=KeyEventArgs}"  -->
    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Grid.Background>
            <ImageBrush
                ImageSource="Assets/Background.png" Stretch="Fill" TileMode="None" />
        </Grid.Background>

        <Viewbox
            Grid.Row="1" Grid.Column="1" Margin="0,0,0,20">
            <Canvas
                Width="250" Height="510" Background="#101010" ClipToBounds="True">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="Loaded">
                        <i:InvokeCommandAction Command="{Binding CanvasLoadedCommand}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
                <ItemsControl ItemsSource="{Binding ImageControls}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="Canvas.Left" Value="{Binding Left}" />
                            <Setter Property="Canvas.Top" Value="{Binding Top}" />
                            <Setter Property="Opacity" Value="{Binding Opacity}" />
                        </Style>
                    </ItemsControl.ItemContainerStyle>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Image
                                Width="25" Height="25"
                                Source="{Binding ImageSource}" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Canvas>
        </Viewbox>

        <TextBlock
            x:Name="ScoreText" Grid.Row="0" Grid.Column="1" Margin="0,10"
            Text="{Binding ScoreText}"
            TextAlignment="Center" />

        <StackPanel
            Grid.Row="1" Grid.Column="0" HorizontalAlignment="Right"
            VerticalAlignment="Center">
            <TextBlock
                Text="Hold" TextAlignment="Center" />
            <Image
                Width="110" Margin="20"
                Source="{Binding HoldImage}" />
        </StackPanel>

        <StackPanel
            Grid.Row="1" Grid.Column="2" Margin="20" HorizontalAlignment="Left"
            VerticalAlignment="Center">
            <TextBlock Text="Next" />
            <Image
                Width="110" Margin="20"
                Source="{Binding NextImage}" />
        </StackPanel>

        <Grid
            Grid.RowSpan="2" Grid.ColumnSpan="3" Background="#CC000000"
            Visibility="{Binding IsGameOver, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel
                HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock
                    FontSize="48" Text="Game Over" TextAlignment="Center" />
                <TextBlock
                    x:Name="FinalScoreText" FontSize="36"
                    Text="{Binding FinalScoreText}"
                    TextAlignment="Center" />
                <Button
                    Margin="0,20,0,0" Padding="5" Background="LightGreen"
                    Command="{Binding RestartGameCommand}"
                    Content="Play Again" />
            </StackPanel>
        </Grid>
    </Grid>
</Window>
